# POE2 交易市场助手

一个完全由 cursor 生成的 Chrome 浏览器插件，用于记录并管理 Path of Exile 2 国服(腾讯)交易市场的搜索历史与收藏。在交易页面右侧以侧边面板形式呈现，支持文件夹、拖拽、导入导出等高级功能。

## 功能特性

-   🔍 **自动记录搜索**: 自动捕获并保存交易页的搜索记录（含去重）
-   🧭 **页面内嵌侧栏**: 固定在页面右侧，100% 高度，与市场页面共存不遮挡
-   🗂️ **标签页系统**: “搜索历史 / 收藏”双标签，并记住上次使用的标签
-   ⭐ **收藏与文件夹**: 支持创建文件夹、重命名、删除、拖拽移动、移动到根目录
-   ➕ **一键收藏当前**: 在根级或文件夹中直接收藏当前搜索，支持自定义名称
-   🔁 **同页跳转优化**: 点击历史/收藏如与当前 URL 一致仅提示、不刷新
-   📦 **导入导出**: 基于 LZ-String + Base64 的压缩分享，一键复制导入代码
-   🔔 **Toast 提示**: 全局自定义 Toast 与对话框，替代浏览器 alert/prompt
-   🎨 **主题优化**: 半透明暗金主题、图标与排版优化、滚动与布局修复
-   ♻️ **状态持久化**: 记住面板展开/收起、最后使用的标签

## 安装方法

### 方法一：开发者模式安装（推荐）

1. 下载或克隆此项目到本地
2. 打开 Chrome 浏览器
3. 访问 `chrome://extensions/`
4. 开启右上角的"开发者模式"
5. 点击"加载已解压的扩展程序"
6. 选择项目文件夹 `poe2-trading-tencent`
7. 插件安装完成！

### 方法二：打包安装

1. 在扩展程序页面点击"打包扩展程序"
2. 选择项目文件夹，生成 `.crx` 文件
3. 将 `.crx` 文件拖拽到 Chrome 浏览器中安装

## 使用方法

1. 打开国服交易页：`https://poe.game.qq.com/trade2/search/poe2/...`
2. 右侧将自动出现插件侧栏，包含“搜索历史 / 收藏”两个标签
3. 常用操作：
    - 🔄 刷新：更新当前标签内容
    - 📌 收起/展开：记住上次展开状态
    - 🗑️ 清空：清空当前标签内容（历史/收藏）
4. 搜索历史：
    - 点击可跳转到对应搜索
    - 若与当前 URL 一致，则只弹 Toast 提示，不刷新
5. 收藏：
    - “📁 新建文件夹” 创建/重命名/删除文件夹
    - “⭐ 收藏当前搜索” 或在文件夹内“⭐ 收藏到此文件夹”
    - 支持拖拽收藏到文件夹、从文件夹移动到根目录
6. 导入/导出：
    - 文件夹右上角“📤”导出 → 一键复制导入代码
    - 收藏页顶部“📥 导入文件夹” → 粘贴导入代码即可

## 支持的网站

-   ✅ `https://poe.game.qq.com/trade2/search/poe2*`（国服 POE2 交易页）

## 技术特性

-   **Manifest V3**：后台 Service Worker + 内容脚本
-   **本地存储**：`chrome.storage.local` 持久化历史、收藏、状态
-   **智能去重**：基于搜索 ID/URL 去重，防止重复记录与收藏
-   **导入导出**：`LZ-String` 压缩 + Base64 文本分享
-   **消息通信**：`chrome.runtime.sendMessage` 串联前后端逻辑
-   **UI 组件**：自定义 Dialog/Toast，HTML5 拖拽

## 文件结构

```
poe2-trading-tencent/
├── manifest.json          # 插件配置文件
├── background.js           # 后台服务脚本
├── content.js             # 内容脚本（注入网页）
├── lib/
│   └── lz-string.js       # LZ-String 压缩库
├── icons/
│   ├── icon16.png         # 16x16图标
│   ├── icon48.png         # 48x48图标
│   └── icon128.png        # 128x128图标
└── README.md              # 说明文档
```

## 开发说明

### 主要组件

1. **Content Script** (`content.js`)

    - 监听页面搜索行为
    - 提取搜索参数
    - 发送数据到后台脚本

2. **Background Script** (`background.js`)

    - 处理数据存储
    - 管理搜索历史
    - 定期清理旧数据

3. **Popup Interface** (`popup/`)
    - 显示搜索历史
    - 提供搜索和管理功能
    - 用户交互界面

### 数据格式

搜索记录格式：

```javascript
{
  id: "唯一标识符",
  url: "完整的搜索URL",
  params: {搜索参数对象},
  timestamp: "ISO时间戳",
  title: "页面标题",
  domain: "网站域名"
}
```

## 更新日志

### v1.1.0 (2025-09-16)

-   面板改为页面内嵌右侧侧栏，记住展开状态与最后使用的标签
-   新增“收藏”页：文件夹管理、拖拽移动、移动到根目录、删除、重命名
-   新增导入/导出：LZ-String 压缩 + Base64 文本代码，一键复制
-   历史/收藏点击同 URL 不跳转，仅 Toast 提示
-   主题与图标优化、滚动与布局修复、统一自定义 Dialog/Toast

## 问题反馈

如果你在使用过程中遇到任何问题或有功能建议，请通过以下方式反馈：

1. 在项目中创建 Issue
2. 发送邮件描述问题
3. 提供详细的操作步骤和截图

## 许可证

本项目采用 MIT 许可证，详见 LICENSE 文件。

## 致谢

-   感谢 Path of Exile 社区的支持
-   参考了 Better PathOfExile Trading 插件的设计理念
-   使用了 Chrome Extensions API

---

**注意**: 本插件仅用于记录搜索历史，不会修改游戏数据或影响游戏平衡性。所有数据均保存在本地，不会上传到任何服务器。
